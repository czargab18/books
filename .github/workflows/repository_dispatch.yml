# Código gerado/assistido por Claude Sonnet 4
name: repository_dispatch - estatistica
description: Dispara evento 'repository_dispatch' no repositório 'estatistica' quando há push para main em arquivos específicos.

on:
  workflow_dispatch:
  push:
    branches: [main]
    paths: ["books/build/**/*.qmd",  "books/build/**/*.yml", "books/build/*.bib"]

permissions:
  contents: read
  actions: write

env:
  USERNAME: ${{ github.repository_owner }}
  TOKEN: ${{ secrets.TOKEN_REPO_SYNC }}

jobs:
  notificar-estatistica:
    environment:
      name: ENVIRONMENT
    runs-on: ubuntu-latest
    steps:
      - name: Dispara 'repository_dispatch' no estatistica
        uses: peter-evans/repository-dispatch@v3
        with:
          repository: ${{ env.USERNAME }}/estatistica
          token: ${{ env.TOKEN }}
          event-type: atualizar-books

      # Posteriormente: Talvez seja útil detectar os livros modificados e enviar como client-payload
      # client-payload: '{"livros": ["livro1", "livro2"]}'
      # E no workflow do repositório 'estatistica', usar os livros modificados.
      # Exemplo:
      # if: contains(github.event.client_payload.livros, 'livro1') 